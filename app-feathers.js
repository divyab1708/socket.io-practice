var express=require("express");
const feathers = require('@feathersjs/feathers');
const socketio = require('@feathersjs/socketio');

//const app =express(feathers());
const app =feathers();
const exApp=express(); // just for routing


/* var currencyPosition=`
[{"_id":"5b3f8a8e98cf6514687fb19e","CCY1":"USD","CCY2":"INR","BID":"68.5151","ASK":"66.1265","LAST_POSITION":"750000000","WAC_RATE":"65.112","LMT_CASH":"5540000","UTIL_CASH":"998800","LMT_TOM":"5750000","UTIL_TOM":"2800000","LMT_SPOT":"5000000","UTIL_SPOT":"","LMT_1M":"5000000","UTIL_1M":"680000","LMT_2M":"5000000","UTIL_2M":"2568010","LMT_3M":"5000000","UTIL_3M":"568240","LMT_4M":"5000000","UTIL_4M":"0","LMT_5M":"5000000","UTIL_5M":"0","LMT_6M":"5000000","UTIL_6M":"0","LMT_7M":"5000000","UTIL_7M":"0","LMT_8M":"5000000","UTIL_8M":"0","LMT_9M":"5000000","UTIL_9M":"0","LMT_10M":"5000000","UTIL_10M":"0","LMT_11M":"5000000","UTIL_11M":"0","LMT_12M":"5000000","UTIL_12M":"0"},{"_id":"5b3f8ad598cf6514687fb1d1","CCY1":"GBP","CCY2":"INR","BID":"81.145","ASK":"82.415","LAST_POSITION":"6500000","WAC_RATE":"65.777","LMT_CASH":"5540000","UTIL_CASH":"8000","LMT_TOM":"3000000","UTIL_TOM":"0","LMT_SPOT":"3000000","UTIL_SPOT":"0","LMT_1M":"3000000","UTIL_1M":"0","LMT_2M":"3000000","UTIL_2M":"0","LMT_3M":"3000000","UTIL_3M":"0","LMT_4M":"3000000","UTIL_4M":"0","LMT_5M":"3000000","UTIL_5M":"0","LMT_6M":"3000000","UTIL_6M":"0","LMT_7M":"3000000","UTIL_7M":"0","LMT_8M":"3000000","UTIL_8M":"0","LMT_9M":"3000000","UTIL_9M":"0","LMT_10M":"3000000","UTIL_10M":"0","LMT_11M":"3000000","UTIL_11M":"0","LMT_12M":"3000000","UTIL_12M":"0"}]

`;*/

var currencyPosition=`
[  
        {
            "CCY1": "USD",
            "CCY2": "INR",
            "BID": "65.546546546",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000,24000000,36000000,16000000,7000000,6000000,5500000,5000000],
            "LAST_POSITION": "5000000",
            "WAC_RATE": "64.5025",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "3853000.00",
            "LMT_TOM": "4000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "8000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "6000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "9000000.00",
            "UTIL_7M": "-1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "-1500000.00",
			"LMT_AGL":"11005000"
        },
        {
            "CCY1": "EUR",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "-7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        },
        {
                            "CCY1": "AUD",
                            "CCY2": "INR",
                            "BID": "80.12345678",
                            "ASK": "75.12345678",
                            "POSITION_HISTORY": [57000000, 5888999, 8989998],
                            "LAST_POSITION": "7000000.00",
                            "WAC_RATE": "78.6185",
                            "LMT_CASH": "5000000.00",
                            "UTIL_CASH": "4000000.00",
                            "LMT_TOM": "5000000.00",
                            "UTIL_TOM": "1500000.00",
                            "LMT_SPOT": "10000000.00",
                            "UTIL_SPOT": "9000000.00",
                            "LMT_1M": "4000000.00",
                            "UTIL_1M": "1500000.00",
                            "LMT_2M": "4000000.00",
                            "UTIL_2M": "1500000.00",
                            "LMT_3M": "4000000.00",
                            "UTIL_3M": "1500000.00",
                            "LMT_4M": "4000000.00",
                            "UTIL_4M": "1500000.00",
                            "LMT_5M": "4000000.00",
                            "UTIL_5M": "1500000.00",
                            "LMT_6M": "4000000.00",
                            "UTIL_6M": "1500000.00",
                            "LMT_7M": "4000000.00",
                            "UTIL_7M": "1500000.00",
                            "LMT_8M": "4000000.00",
                            "UTIL_8M": "1500000.00",
                            "LMT_9M": "4000000.00",
                            "UTIL_9M": "1500000.00",
                            "LMT_10M": "4000000.00",
                            "UTIL_10M": "1500000.00",
                            "LMT_11M": "4000000.00",
                            "UTIL_11M": "1500000.00",
                            "LMT_12M": "4000000.00",
                            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
                        },
        {
            "CCY1": "AED",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        },
        {
            "CCY1": "CAD",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        },
        {
            "CCY1": "CHF",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        },
        {
            "CCY1": "GBP",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "-7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        },
        {
            "CCY1": "HKD",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        },
        {
            "CCY1": "JPY",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        },
        {
                            "CCY1": "NZD",
                            "CCY2": "INR",
                            "BID": "80.12345678",
                            "ASK": "75.12345678",
                            "POSITION_HISTORY": [57000000, 5888999, 8989998],
                            "LAST_POSITION": "7000000.00",
                            "WAC_RATE": "78.6185",
                            "LMT_CASH": "5000000.00",
                            "UTIL_CASH": "4000000.00",
                            "LMT_TOM": "5000000.00",
                            "UTIL_TOM": "1500000.00",
                            "LMT_SPOT": "10000000.00",
                            "UTIL_SPOT": "9000000.00",
                            "LMT_1M": "4000000.00",
                            "UTIL_1M": "1500000.00",
                            "LMT_2M": "4000000.00",
                            "UTIL_2M": "1500000.00",
                            "LMT_3M": "4000000.00",
                            "UTIL_3M": "1500000.00",
                            "LMT_4M": "4000000.00",
                            "UTIL_4M": "1500000.00",
                            "LMT_5M": "4000000.00",
                            "UTIL_5M": "1500000.00",
                            "LMT_6M": "4000000.00",
                            "UTIL_6M": "1500000.00",
                            "LMT_7M": "4000000.00",
                            "UTIL_7M": "1500000.00",
                            "LMT_8M": "4000000.00",
                            "UTIL_8M": "1500000.00",
                            "LMT_9M": "4000000.00",
                            "UTIL_9M": "1500000.00",
                            "LMT_10M": "4000000.00",
                            "UTIL_10M": "1500000.00",
                            "LMT_11M": "4000000.00",
                            "UTIL_11M": "1500000.00",
                            "LMT_12M": "4000000.00",
                            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
                        },
        {
            "CCY1": "SEK",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        },
        {
            "CCY1": "SGD",
            "CCY2": "INR",
            "BID": "80.12345678",
            "ASK": "75.12345678",
            "POSITION_HISTORY": [57000000, 5888999, 8989998],
            "LAST_POSITION": "7000000.00",
            "WAC_RATE": "78.6185",
            "LMT_CASH": "5000000.00",
            "UTIL_CASH": "4000000.00",
            "LMT_TOM": "5000000.00",
            "UTIL_TOM": "1500000.00",
            "LMT_SPOT": "10000000.00",
            "UTIL_SPOT": "9000000.00",
            "LMT_1M": "4000000.00",
            "UTIL_1M": "1500000.00",
            "LMT_2M": "4000000.00",
            "UTIL_2M": "1500000.00",
            "LMT_3M": "4000000.00",
            "UTIL_3M": "1500000.00",
            "LMT_4M": "4000000.00",
            "UTIL_4M": "1500000.00",
            "LMT_5M": "4000000.00",
            "UTIL_5M": "1500000.00",
            "LMT_6M": "4000000.00",
            "UTIL_6M": "1500000.00",
            "LMT_7M": "4000000.00",
            "UTIL_7M": "1500000.00",
            "LMT_8M": "4000000.00",
            "UTIL_8M": "1500000.00",
            "LMT_9M": "4000000.00",
            "UTIL_9M": "1500000.00",
            "LMT_10M": "4000000.00",
            "UTIL_10M": "1500000.00",
            "LMT_11M": "4000000.00",
            "UTIL_11M": "1500000.00",
            "LMT_12M": "4000000.00",
            "UTIL_12M": "1500000.00",
			"LMT_AGL":"11005000"
        }
      ]
`

var updateObj=`[{ "CCY1" : "USD", "CCY2" : "INR", "BID" : "65.95", "ASK" : "66.5", "LAST_POSITION" : "750000000", "WAC_RATE" : "65.112", "LMT_CASH" : "5540000", "UTIL_CASH" : "-8540000", "LMT_TOM" : "5000000", "UTIL_TOM" : "0", "LMT_SPOT" : "5000000", "UTIL_SPOT" : "0", "LMT_1M" : "5000000", "UTIL_1M" : "0", "LMT_2M" : "5000000", "UTIL_2M" : "0", "LMT_3M" : "5000000", "UTIL_3M" : "0", "LMT_4M" : "5000000", "UTIL_4M" : "0", "LMT_5M" : "5000000", "UTIL_5M" : "0", "LMT_6M" : "5000000", "UTIL_6M" : "0", "LMT_7M" : "5000000", "UTIL_7M" : "0", "LMT_8M" : "5000000", "UTIL_8M" : "0", "LMT_9M" : "5000000", "UTIL_9M" : "0", "LMT_10M" : "5000000", "UTIL_10M" : "0", "LMT_11M" : "5000000", "UTIL_11M" : "0", "LMT_12M" : "5000000", "UTIL_12M" : "0" ,"LMT_AGL":"11005000"}]`;

 /*for routing*/
exApp.use("/src", express.static(__dirname + "/src")); 
exApp.get('/', function(req, res){
  res.sendFile(__dirname + '/userIp.html');
});

exApp.get('/dash', function(req, res){
  res.sendFile(__dirname + '/dash.html');
});


 /* end for routing*/


app.configure(socketio(function(io) {
  io.on('connection', function(socket) {
    
  });
    


  // Registering Socket.io middleware
  io.use(function (socket, next) {
    // Exposing a request property to services and hooks
    socket.feathers.referrer = socket.request.referrer;
    next();
  });
}));





exApp.listen(3030, function(){console.log("listening 3030")}); // just for routing
app.listen(3040, function(){console.log("listening 3040")});

const currencyPos_nsp = app.io.of('/fxposition');

currencyPos_nsp.on('connection',function(socket){
    console.log("connect");
      console.log("connected");
      currencyPos_nsp.emit('first time load data', currencyPosition); // emit currencyPosition data on first time load
//      currencyPos_nsp.emit('onload_fxposition', currencyPosition); // emit currencyPosition data on first time load
      
      
          socket.on("currency change",function(data){   // When a currency is updated
//          socket.on("update_fxposition",function(data){   // When a currency is updated
         
                    console.log("sending update");
                  currencyPos_nsp.emit('update currency position', updateObj); // emit updated data
//                  io.emit('update currency position', data); // emit updated data

            });
})
